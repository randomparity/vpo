# Multi-Phase Policy Fixture
# Used to test multiple phase execution in order
schema_version: 13

config:
  audio_languages: [eng, jpn, und]
  subtitle_languages: [eng, jpn]
  commentary_patterns: [commentary, director]
  on_error: continue

phases:
  - name: cleanup
    keep_audio:
      languages: [eng, jpn, und]
      minimum: 1
    keep_subtitles:
      languages: [eng, jpn]
      preserve_forced: true
    filter_attachments:
      remove_all: true

  - name: organize
    track_order:
      - video
      - audio_main
      - audio_alternate
      - subtitle_main
      - subtitle_forced
    default_flags:
      set_first_video_default: true
      set_preferred_audio_default: true

  - name: compress
    transcode:
      video:
        to: hevc
        skip_if:
          codec_matches: [hevc, h265]
        crf: 20
        preset: medium
      audio:
        preserve: [truehd, dts-hd, flac]
        to: aac
        bitrate: 192k
