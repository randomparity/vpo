# Simple HEVC Transcoding Policy (V12)
# Minimal single-phase policy for video transcoding
#
# Converts video to HEVC (H.265) for better compression at equivalent quality.
# Files already meeting all skip conditions are left untouched.
#
# Usage:
#   vpo policy run -p transcode-hevc.yaml /path/to/videos/ --dry-run
schema_version: 12
name: Simple HEVC Transcode
description: Single-phase HEVC transcoding capped at 1080p with sensible defaults.

config:
  on_error: skip

phases:
  - name: compress
    transcode:
      video:
        target_codec: hevc  # Also accepts: h264, av1

        # Skip transcoding if ALL of these conditions are already met.
        # If any condition fails, the file is transcoded.
        skip_if:
          codec_matches: [hevc, h265]  # Already in target codec
          resolution_within: 1080p     # At or below 1080p
          bitrate_under: 15M           # Under 15 Mbps (already efficient)

        # Quality settings control the output encoding.
        quality:
          mode: crf      # Constant Rate Factor â€” variable bitrate for consistent quality
                         # Alternative: "bitrate" for fixed bitrate mode
          crf: 20        # Lower = better quality, larger files. Range: 0-51
                         #   18 = visually lossless, 20 = high quality, 23 = default, 28 = low
          preset: medium # Encoding speed/quality tradeoff. Slower = smaller files.
                         # Options: ultrafast, superfast, veryfast, faster, fast,
                         #          medium, slow, slower, veryslow

        # Downscale video if above max resolution. Does not upscale.
        scaling:
          max_resolution: 1080p  # Options: 480p, 720p, 1080p, 1440p, 2160p
          algorithm: lanczos     # Options: lanczos, bicubic, bilinear, spline

      audio:
        # Keep these codecs as-is (no re-encoding). Lossless codecs are
        # expensive to encode and should usually be preserved.
        preserve_codecs: [truehd, dts-hd, flac]

        # Re-encode all other audio codecs to this format.
        transcode_to: aac            # Common choices: aac, ac3, eac3, opus
        transcode_bitrate: 192k      # Per-channel: 192k stereo, scales with channels
