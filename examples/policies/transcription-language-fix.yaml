# Example policy: Auto-fix language tags using transcription
#
# This policy enables automatic language detection and updates
# for audio tracks with undefined or potentially incorrect language tags.
#
# Use with: vpo apply --policy transcription-language-fix.yaml /path/to/file.mkv
#
# Requirements:
# - openai-whisper package must be installed for local transcription
# - File must be scanned first: vpo scan /path/to/file.mkv
# - Audio tracks should have transcription results: vpo transcribe detect /path/to/file.mkv

schema_version: 1

# Language preferences for track ordering
audio_language_preference:
  - eng  # English first
  - jpn  # Japanese second
  - und  # Undefined last

subtitle_language_preference:
  - eng
  - jpn
  - und

# Commentary detection patterns (regex)
# Tracks matching these patterns will be classified as commentary
commentary_patterns:
  - commentary
  - director
  - cast
  - crew
  - "behind.*scenes"
  - "making.*of"

# Track order: main content first, commentary last
track_order:
  - video
  - audio_main
  - audio_alternate
  - audio_commentary
  - subtitle_forced
  - subtitle_main
  - subtitle_commentary
  - attachment

# Default flags configuration
default_flags:
  set_first_video_default: true
  set_preferred_audio_default: true
  set_preferred_subtitle_default: false
  clear_other_defaults: true

# Transcription-based features
transcription:
  # Enable transcription analysis
  enabled: true

  # Automatically update language tags based on detected language
  # Only updates if confidence exceeds threshold
  update_language_from_transcription: true

  # Minimum confidence score required to update language tags
  # Range: 0.0 to 1.0 (0.8 = 80% confidence required)
  confidence_threshold: 0.8

  # Enable commentary detection from transcript content
  # Analyzes transcript for phrases like "when we filmed this..."
  detect_commentary: true

  # Move detected commentary tracks after main audio tracks
  # Requires detect_commentary to be true
  reorder_commentary: true
