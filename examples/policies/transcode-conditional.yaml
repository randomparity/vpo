# Conditional Transcoding Policy (V12)
# Two-phase workflow with smart skip conditions and hardware acceleration
schema_version: 12

config:
  on_error: skip

phases:
  - name: prepare
    container:
      target: mkv
      on_incompatible_codec: transcode

  - name: compress
    transcode:
      video:
        target_codec: hevc
        skip_if:
          codec_matches: [hevc, h265]
          resolution_within: 1080p
          bitrate_under: 15M
        quality:
          mode: crf
          crf: 20
          preset: medium
          tune: film
        scaling:
          max_resolution: 1080p
          algorithm: lanczos
          upscale: false
        hardware_acceleration:
          enabled: auto
          fallback_to_cpu: true
      audio:
        preserve_codecs: [truehd, dts-hd, flac, pcm_s24le]
        transcode_to: aac
        transcode_bitrate: 192k
