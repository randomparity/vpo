# Feature Specification: Plans List View

**Feature Branch**: `026-plans-list-view`
**Created**: 2025-11-25
**Status**: Draft
**Input**: User description: "Implement planned changes (plans) list view - Create an Approvals/Plans page showing all pending and historical planned changes generated by dry-run evaluations."

## Clarifications

### Session 2025-11-25

- Q: Where do plan status transitions (approve/reject) occur? → A: List view includes inline approve/reject action buttons for pending plans.
- Q: How does the list stay current when plans change? → A: Auto-refresh via polling every 5 seconds (consistent with Jobs Dashboard VPOPolling default interval).
- Q: How to handle plans whose source (policy/job) was deleted? → A: Display plan with "[Deleted]" indicator for the missing source.
- Q: Should status filter support multi-select? → A: Single-select dropdown with "All statuses" option (consistent with Jobs Dashboard pattern).

## User Scenarios & Testing *(mandatory)*

### User Story 1 - View All Plans (Priority: P1)

As an operator, I want to see a list of all planned changes so that I can understand what changes are pending approval and review historical changes that have been processed.

**Why this priority**: This is the core functionality of the feature. Without the ability to view plans, no other interactions are possible. This enables operators to have visibility into the system's pending work.

**Independent Test**: Can be fully tested by navigating to the Plans page and verifying that plans are displayed with their essential information (ID, creation time, source, file count, status).

**Acceptance Scenarios**:

1. **Given** plans exist in the system, **When** the operator navigates to the Plans page, **Then** they see a list of all plans with Plan ID, creation time, source, number of files impacted, and status displayed for each entry.
2. **Given** no plans exist in the system, **When** the operator navigates to the Plans page, **Then** they see an empty state message indicating no plans are available.
3. **Given** plans exist with various statuses, **When** the operator views the list, **Then** each plan displays its current status using a visual indicator (color-coded badge or icon).

---

### User Story 2 - Filter Plans by Status (Priority: P2)

As an operator, I want to filter plans by their status so that I can focus on plans requiring my attention (such as pending plans) or review specific categories of historical changes.

**Why this priority**: Filtering by status is essential for operators to efficiently manage their workflow, especially when there are many plans. Operators need to quickly find pending plans that require action.

**Independent Test**: Can be tested by applying status filters and verifying that only plans matching the selected status appear in the list.

**Acceptance Scenarios**:

1. **Given** plans exist with different statuses, **When** the operator selects the "pending" status filter, **Then** only plans with pending status are displayed.
2. **Given** plans exist with different statuses, **When** the operator changes the status filter selection, **Then** only plans matching the selected status are displayed (or all plans if "All statuses" is selected).
3. **Given** a status filter is active, **When** the operator clears the filter, **Then** all plans are displayed again.

---

### User Story 3 - Filter Plans by Creation Time (Priority: P2)

As an operator, I want to filter plans by creation time range so that I can review plans from a specific period or focus on recently created plans.

**Why this priority**: Time-based filtering helps operators manage large volumes of plans by focusing on relevant time periods, such as reviewing what happened yesterday or this week.

**Independent Test**: Can be tested by setting a date range filter and verifying that only plans created within that range appear in the list.

**Acceptance Scenarios**:

1. **Given** plans exist across multiple dates, **When** the operator sets a creation time range filter, **Then** only plans created within that date range are displayed.
2. **Given** a date range filter is active, **When** the operator clears the filter, **Then** all plans are displayed regardless of creation date.
3. **Given** plans exist, **When** the operator selects a predefined time range (e.g., "Today", "Last 7 days"), **Then** plans matching that time period are shown.

---

### User Story 4 - Approve or Reject Plans Inline (Priority: P2)

As an operator, I want to approve or reject pending plans directly from the list view so that I can quickly process simple approvals without navigating to each plan's detail page.

**Why this priority**: Inline actions significantly improve workflow efficiency when processing multiple pending plans. Operators can make quick decisions for straightforward plans while still having the option to drill into details for complex ones.

**Independent Test**: Can be tested by clicking approve/reject buttons on a pending plan and verifying the status updates immediately in the list.

**Acceptance Scenarios**:

1. **Given** a plan has status "pending", **When** the operator clicks the "Approve" button, **Then** the plan status changes to "approved" and the list updates to reflect the new status.
2. **Given** a plan has status "pending", **When** the operator clicks the "Reject" button, **Then** the plan status changes to "rejected" and the list updates to reflect the new status.
3. **Given** a plan has status other than "pending", **When** the operator views that plan row, **Then** no approve/reject action buttons are displayed.
4. **Given** the operator clicks an action button, **When** the action completes, **Then** a brief confirmation message is displayed.

---

### User Story 5 - Navigate to Plan Details (Priority: P3)

As an operator, I want to click on a plan to see its detailed information so that I can review the specific changes included before making approval decisions on complex plans.

**Why this priority**: While inline actions handle simple approvals, operators need to drill into details for complex plans to understand the full scope of changes before deciding.

**Independent Test**: Can be tested by clicking on a plan row and verifying navigation to a detail view showing more information about that plan.

**Acceptance Scenarios**:

1. **Given** the operator is viewing the plans list, **When** they click on a plan entry (not on an action button), **Then** they are navigated to the plan detail view for that specific plan.
2. **Given** the operator clicks on a plan, **When** the detail view loads, **Then** the plan's full information is displayed including all affected files and proposed changes.

---

### User Story 6 - Live Updates via Polling (Priority: P3)

As an operator, I want the plans list to automatically refresh so that I see status changes made by other users or background processes without manually reloading the page.

**Why this priority**: Auto-refresh ensures operators always see current data, which is important when multiple operators may be processing plans or when background jobs change plan statuses.

**Independent Test**: Can be tested by modifying a plan's status via another session and verifying the change appears in the list within the polling interval.

**Acceptance Scenarios**:

1. **Given** the operator is viewing the plans list, **When** a plan's status changes (by another user or process), **Then** the list updates automatically within the polling interval to show the new status.
2. **Given** the operator is viewing the plans list, **When** a new plan is created, **Then** it appears in the list on the next polling cycle (respecting current filters).
3. **Given** polling is active, **When** the operator interacts with the page (filtering, scrolling), **Then** polling continues without interruption.

---

### Edge Cases

- **Pagination**: When the plans list exceeds the page size threshold (50 items), the system displays paginated results (FR-008).
- **Empty filter results**: When filters yield no matching plans, the system displays an appropriate empty state message (FR-007).
- **Deleted source**: When a plan's source (policy/job) has been deleted, the plan remains visible with a "[Deleted]" indicator for the source (FR-017).
- **Concurrent status change**: When a plan's status changes while the operator is viewing the list, the polling mechanism automatically updates the display (FR-015).

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: System MUST display a list of all plans with the following information for each: Plan ID, creation time, source (policy/profile and/or originating job), number of files impacted, and status.
- **FR-002**: System MUST support the following plan statuses: pending, approved, applied, canceled, and rejected.
- **FR-003**: System MUST provide a status filter allowing operators to filter plans by one or more statuses.
- **FR-004**: System MUST provide a creation time filter allowing operators to filter plans by date range.
- **FR-005**: System MUST display plans in reverse chronological order by default (newest first).
- **FR-006**: System MUST support navigation from a plan list entry to that plan's detail view.
- **FR-007**: System MUST display an appropriate empty state when no plans exist or when filters yield no results.
- **FR-008**: System MUST handle pagination when the number of plans exceeds a reasonable display threshold (e.g., 50 items per page).
- **FR-009**: System MUST display the source information in a human-readable format, showing the policy name and/or job reference.
- **FR-010**: System MUST visually distinguish plans by status using color-coding or icons to enable quick scanning.
- **FR-011**: System MUST display inline "Approve" and "Reject" action buttons for plans with "pending" status.
- **FR-012**: System MUST NOT display approve/reject action buttons for plans with non-pending statuses (approved, applied, canceled, rejected).
- **FR-013**: System MUST update the plan's status immediately in the list when an approve or reject action is performed.
- **FR-014**: System MUST display a brief confirmation message after a successful approve or reject action.
- **FR-015**: System MUST automatically refresh the plans list via polling at a regular interval (consistent with existing live update patterns in the application).
- **FR-016**: System MUST preserve the current filter and pagination state during automatic refresh updates.
- **FR-017**: System MUST display plans even when the referenced source (policy/job) has been deleted, showing a "[Deleted]" indicator in place of the source name.

### Key Entities

- **Plan**: Represents a set of proposed changes generated from a dry-run evaluation. Contains an identifier, creation timestamp, source reference (policy/job), list of affected files, and a status indicating its lifecycle stage.
- **Plan Status**: An enumeration representing the lifecycle stage of a plan: pending (awaiting review), approved (accepted for execution), applied (changes have been executed), canceled (withdrawn by operator), rejected (declined by operator).
- **Source**: Reference to the policy, profile, or job that generated the plan. May include the policy name and/or the job identifier that triggered the dry-run evaluation.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Operators can view and understand all pending plans within 30 seconds of navigating to the Plans page.
- **SC-002**: Operators can locate a specific plan using filters within 10 seconds when they know the approximate creation date or status.
- **SC-003**: The Plans page loads and displays initial results within 2 seconds for libraries with up to 1,000 plans.
- **SC-004**: 90% of operators can successfully filter plans by status on their first attempt without documentation.
- **SC-005**: Operators can navigate from the plans list to a specific plan's detail view with a single click.
- **SC-006**: The plans list accurately reflects the current state of all plans in the system (no stale or missing entries).

## Assumptions

- Plans are created by dry-run evaluations of policies against files in the library.
- The plan detail view (referenced in FR-006) will be implemented as a separate feature.
- The system already has a mechanism for storing and retrieving plan data.
- Operators have appropriate permissions to view all plans (no role-based filtering required for this feature).
- The web UI follows the existing design patterns established in other list views (e.g., Jobs Dashboard, Library List View).
- Predefined time range options (Today, Last 7 days, Last 30 days) provide sufficient flexibility for most use cases.
- A page size of 50 items provides a good balance between information density and performance.
